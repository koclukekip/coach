<section class="container" style="max-width:1000px;margin:24px auto;display:grid;grid-template-columns:320px 1fr;gap:16px">
  <div>
    <h2>Ã–ÄŸrencilerim</h2>
    <form (ngSubmit)="assign()" style="display:flex;gap:8px;margin:8px 0">
      <input name="student" [ngModel]="studentToAssign()" (ngModelChange)="studentToAssign.set($event)" placeholder="Ã–ÄŸrenci kullanÄ±cÄ± adÄ±" style="flex:1;border:1px solid #e5e7eb;border-radius:8px;padding:8px"/>
      <button class="btn btn-primary" type="submit">Ekle</button>
    </form>
    <div *ngFor="let s of myStudents()" style="border:1px solid #e5e7eb;border-radius:10px;padding:10px;margin:8px 0">
      <div style="font-weight:600">{{ s.studentUsername }}</div>
      <div style="font-size:12px;color:#64748b">Atanan koÃ§: {{ s.coachUsername }}</div>
    </div>
    <h2 style="margin-top:24px">Gelen Sohbet Talepleri</h2>
  </div>
  <div>
    <h1 style="margin-top:0">Sohbetler</h1>
  <div *ngFor="let c of convs()" (click)="c.status==='ACCEPTED' && open(c)" class="chat-card">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <div>
        <div style="font-weight:600">Ã–ÄŸrenci: {{ c.studentUsername }}</div>
        <div style="font-size:12px;color:#64748b;display:flex;align-items:center;gap:6px">
          <span>Durum:</span>
          <span *ngIf="c.status==='ACCEPTED'" aria-label="Kabul edildi" title="Kabul edildi" style="color:#16a34a">âœ“</span>
          <span *ngIf="c.status==='REJECTED'" aria-label="Reddedildi" title="Reddedildi" style="color:#dc2626">âœ—</span>
          <span *ngIf="c.status==='PENDING'" aria-label="Beklemede" title="Beklemede" style="color:#64748b">â€¢</span>
        </div>
      </div>
      <button class="btn btn-primary" (click)="accept(c); $event.stopPropagation()" [disabled]="c.status==='ACCEPTED'">Kabul Et</button>
    </div>
    <div *ngIf="activeId()===c.id" style="margin-top:10px;border-top:1px solid #e5e7eb;padding-top:10px;width:100%">
      <div #messagesBox class="messages">
        <ng-container *ngFor="let m of messages(); let i = index">
          <div *ngIf="isNewDay(i)" style="text-align:center;color:#94a3b8;font-size:12px;margin:6px 0">{{ formatDay(m.ts) }}</div>
          <div [style]="m.role==='user'? 'text-align:left' : 'text-align:right'">
            <span class="bubble" [class.me]="m.role==='user'" [class.them]="m.role==='coach'">
              {{ m.text }}
              <div class="meta">{{ formatTime(m.ts) }}</div>
            </span>
          </div>
        </ng-container>
      </div>
      <div style="display:flex;gap:8px;margin-top:10px;align-items:center">
        <button class="btn" type="button" (click)="toggleVideo()" style="border:1px solid #e5e7eb;border-radius:10px;padding:10px 14px">ðŸŽ¥ Video</button>
      </div>
      <div *ngIf="videoActive()" style="display:flex;gap:8px;margin-top:10px;align-items:flex-start">
        <video [appMediaStream]="localStream()" muted playsinline style="width:45%;background:#000;border-radius:8px"></video>
        <video [appMediaStream]="remoteStream()" playsinline style="width:55%;background:#000;border-radius:8px"></video>
      </div>
      <form (ngSubmit)="send()" style="display:flex;gap:8px;margin-top:10px">
        <input name="msg" [ngModel]="draft()" (ngModelChange)="draft.set($event)" placeholder="Mesaj yazÄ±n..." style="flex:1;border:1px solid #e5e7eb;border-radius:10px;padding:10px"/>
        <button class="btn btn-primary" type="submit" style="background:#36786b;color:#fff;border:none;border-radius:10px;padding:10px 14px">GÃ¶nder</button>
      </form>
    </div>
  </div>
  </div>
</section>



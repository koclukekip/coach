<section class="container" style="max-width:900px;margin:24px auto">
  <h1>Dokümanlarım</h1>
  <div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap">
    <input type="file" multiple (change)="onFile($event)"/>
    <input #q placeholder="Ara…" [value]="query()" (input)="query.set(q.value)" style="padding:8px;border:1px solid #e5e7eb;border-radius:8px"/>
    <span *ngIf="uploading()" style="font-size:12px;color:#64748b">Yükleniyor…</span>
  </div>
  <div (drop)="onDrop($event)" (dragover)="onDragOver($event)" style="margin-top:10px;padding:16px;border:2px dashed #cbd5e1;border-radius:12px;color:#64748b">Dosyaları buraya sürükleyip bırakın</div>
  <div style="margin-top:10px" *ngIf="err()" class="err">{{ err() }}</div>
  <div style="margin-top:16px">
    <div *ngFor="let d of filteredDocs()" style="display:flex;justify-content:space-between;align-items:center;border:1px solid #e5e7eb;border-radius:10px;padding:10px;margin:8px 0">
      <div style="display:flex;align-items:center;gap:10px">
        <span style="font-weight:600">{{ d.filename }}</span>
      </div>
      <div style="display:flex;gap:8px">
        <button class="btn" (click)="previewDoc(d)">Önizle</button>
        <a [href]="svc.downloadUrl(d.id)" class="btn">İndir</a>
        <button class="btn" (click)="deleteDoc(d)" style="color:#dc2626;border-color:#fecaca">Sil</button>
      </div>
    </div>
  </div>
  <div *ngIf="previewing()" style="position:fixed;inset:0;background:rgba(0,0,0,.5);display:flex;align-items:center;justify-content:center;z-index:9999">
    <div style="background:#fff;border-radius:12px;width:min(1200px,95vw);max-width:95vw;height:90vh;max-height:95vh;border:1px solid #e5e7eb;display:flex;flex-direction:column">
      <div style="display:flex;justify-content:space-between;align-items:center;padding:10px 14px;border-bottom:1px solid #e5e7eb">
        <div style="font-weight:700">{{ previewing()!.filename }}</div>
        <button class="btn" (click)="closePreview()">Kapat</button>
      </div>
      <div style="flex:1;min-height:0">
        <div *ngIf="previewErr()" style="padding:16px;color:#dc2626">{{ previewErr() }}</div>
        <img *ngIf="previewUrl() && !previewErr() && !previewText() && !previewIsPdf()" [src]="previewUrl()" style="display:block;max-width:100%;max-height:100%;margin:0 auto"/>
        <object *ngIf="previewUrl() && !previewErr() && previewIsPdf()" [data]="previewUrl()" type="application/pdf" style="display:block;width:100%;height:100%">
          <div style="padding:16px">PDF önizleme desteklenmiyor. <a [href]="previewUrl()" target="_blank" rel="noopener">Yeni sekmede aç</a>.</div>
        </object>
        <pre *ngIf="previewText() && !previewErr()" style="margin:0;padding:12px;white-space:pre-wrap;word-wrap:break-word;height:100%;overflow:auto;background:#f8fafc">{{ previewText() }}</pre>
      </div>
      <div style="display:flex;gap:8px;justify-content:flex-end;padding:10px 14px;border-top:1px solid #e5e7eb">
        <button class="btn" (click)="deleteDoc(previewing()!)" style="color:#dc2626;border-color:#fecaca">Sil</button>
        <a [href]="svc.downloadUrl(previewing()!.id)" class="btn">İndir</a>
      </div>
    </div>
  </div>
</section>


